<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>IOTsec: lib/src/iotsec_client.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">IOTsec
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">Secure communication protocol for IOT devices</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97aefd0d527b934f1d99a682da8fe6a9.html">lib</a></li><li class="navelem"><a class="el" href="dir_a065c5f60305fee3569f887679366939.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">iotsec_client.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Source file for the IOTsec client library.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;errno.h&gt;</code><br />
<code>#include &lt;fcntl.h&gt;</code><br />
<code>#include &lt;netdb.h&gt;</code><br />
<code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;sys/select.h&gt;</code><br />
<code>#include &lt;sys/socket.h&gt;</code><br />
<code>#include &lt;sys/timerfd.h&gt;</code><br />
<code>#include &lt;sys/types.h&gt;</code><br />
<code>#include &lt;unistd.h&gt;</code><br />
<code>#include &quot;<a class="el" href="iotsec__client_8h_source.html">iotsec_client.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="iotsec__log_8h_source.html">iotsec_log.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="iotsec__mem_8h_source.html">iotsec_mem.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for iotsec_client.c:</div>
<div class="dyncontent">
<div class="center"><img src="iotsec__client_8c__incl.png" border="0" usemap="#alib_2src_2iotsec__client_8c" alt=""/></div>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:aa430754eb49845b6f88dc83fae70b5c4"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="iotsec__client_8c.html#aa430754eb49845b6f88dc83fae70b5c4">IOTSEC_CLIENT_ACK_TIMEOUT_SEC</a>&#160;&#160;&#160;  2</td></tr>
<tr class="separator:aa430754eb49845b6f88dc83fae70b5c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a740a0ba58b2a4c4bc6319c3a81812547"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="iotsec__client_8c.html#a740a0ba58b2a4c4bc6319c3a81812547">IOTSEC_CLIENT_MAX_RETRANSMIT</a>&#160;&#160;&#160;  4</td></tr>
<tr class="separator:a740a0ba58b2a4c4bc6319c3a81812547"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af91933ae42af58c57bf685039e6141b2"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="iotsec__client_8c.html#af91933ae42af58c57bf685039e6141b2">IOTSEC_CLIENT_RESP_TIMEOUT_SEC</a>&#160;&#160;&#160;  30</td></tr>
<tr class="separator:af91933ae42af58c57bf685039e6141b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:af6e0474834a1647f62595019c574bb4d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="iotsec__client_8c.html#af6e0474834a1647f62595019c574bb4d">iotsec_client_create</a> (<a class="el" href="structiotsec__client__t.html">iotsec_client_t</a> *client, const char *host, const char *port)</td></tr>
<tr class="memdesc:af6e0474834a1647f62595019c574bb4d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialise a client structure.  <a href="iotsec__client_8c.html#af6e0474834a1647f62595019c574bb4d">More...</a><br /></td></tr>
<tr class="separator:af6e0474834a1647f62595019c574bb4d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a42efcaa9e351912d13920ccb3e99eb4b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="iotsec__client_8c.html#a42efcaa9e351912d13920ccb3e99eb4b">iotsec_client_destroy</a> (<a class="el" href="structiotsec__client__t.html">iotsec_client_t</a> *client)</td></tr>
<tr class="memdesc:a42efcaa9e351912d13920ccb3e99eb4b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Deinitialise a client structure.  <a href="iotsec__client_8c.html#a42efcaa9e351912d13920ccb3e99eb4b">More...</a><br /></td></tr>
<tr class="separator:a42efcaa9e351912d13920ccb3e99eb4b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6d114626f981731206976d64ba4a9082"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="iotsec__client_8c.html#a6d114626f981731206976d64ba4a9082">iotsec_client_exchange</a> (<a class="el" href="structiotsec__client__t.html">iotsec_client_t</a> *client, <a class="el" href="structiotsec__msg__t.html">iotsec_msg_t</a> *req, <a class="el" href="structiotsec__msg__t.html">iotsec_msg_t</a> *resp)</td></tr>
<tr class="memdesc:a6d114626f981731206976d64ba4a9082"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send a request to the server and receive the response.  <a href="iotsec__client_8c.html#a6d114626f981731206976d64ba4a9082">More...</a><br /></td></tr>
<tr class="separator:a6d114626f981731206976d64ba4a9082"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abf1cda72f615128e0ab705562e809bc7"><td class="memItemLeft" align="right" valign="top">ssize_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="iotsec__client_8c.html#abf1cda72f615128e0ab705562e809bc7">iotsec_client_exchange_blockwise</a> (<a class="el" href="structiotsec__client__t.html">iotsec_client_t</a> *client, <a class="el" href="structiotsec__msg__t.html">iotsec_msg_t</a> *req, <a class="el" href="structiotsec__msg__t.html">iotsec_msg_t</a> *resp, unsigned block1_size, unsigned block2_size, char *body, size_t body_len, int have_resp)</td></tr>
<tr class="memdesc:abf1cda72f615128e0ab705562e809bc7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Exchange with the server using blockwise transfers.  <a href="iotsec__client_8c.html#abf1cda72f615128e0ab705562e809bc7">More...</a><br /></td></tr>
<tr class="separator:abf1cda72f615128e0ab705562e809bc7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Source file for the IOTsec client library. </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="aa430754eb49845b6f88dc83fae70b5c4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa430754eb49845b6f88dc83fae70b5c4">&#9670;&nbsp;</a></span>IOTSEC_CLIENT_ACK_TIMEOUT_SEC</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IOTSEC_CLIENT_ACK_TIMEOUT_SEC&#160;&#160;&#160;  2</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Minimum delay to wait before retransmitting a confirmable message </p>

</div>
</div>
<a id="a740a0ba58b2a4c4bc6319c3a81812547"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a740a0ba58b2a4c4bc6319c3a81812547">&#9670;&nbsp;</a></span>IOTSEC_CLIENT_MAX_RETRANSMIT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IOTSEC_CLIENT_MAX_RETRANSMIT&#160;&#160;&#160;  4</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Maximum number of times a confirmable message can be retransmitted </p>

</div>
</div>
<a id="af91933ae42af58c57bf685039e6141b2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af91933ae42af58c57bf685039e6141b2">&#9670;&nbsp;</a></span>IOTSEC_CLIENT_RESP_TIMEOUT_SEC</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IOTSEC_CLIENT_RESP_TIMEOUT_SEC&#160;&#160;&#160;  30</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Maximum amount of time to wait for a response </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="af6e0474834a1647f62595019c574bb4d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af6e0474834a1647f62595019c574bb4d">&#9670;&nbsp;</a></span>iotsec_client_create()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int iotsec_client_create </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structiotsec__client__t.html">iotsec_client_t</a> *&#160;</td>
          <td class="paramname"><em>client</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>host</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>port</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialise a client structure. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">client</td><td>Pointer to a client structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">host</td><td>Pointer to a string containing the host address of the server </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">port</td><td>Port number of the server</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Operation status </dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>Success </td></tr>
    <tr><td class="paramname">&lt;0</td><td>Error </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a42efcaa9e351912d13920ccb3e99eb4b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a42efcaa9e351912d13920ccb3e99eb4b">&#9670;&nbsp;</a></span>iotsec_client_destroy()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void iotsec_client_destroy </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structiotsec__client__t.html">iotsec_client_t</a> *&#160;</td>
          <td class="paramname"><em>client</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Deinitialise a client structure. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">client</td><td>Pointer to a client structure </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a6d114626f981731206976d64ba4a9082"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6d114626f981731206976d64ba4a9082">&#9670;&nbsp;</a></span>iotsec_client_exchange()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int iotsec_client_exchange </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structiotsec__client__t.html">iotsec_client_t</a> *&#160;</td>
          <td class="paramname"><em>client</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structiotsec__msg__t.html">iotsec_msg_t</a> *&#160;</td>
          <td class="paramname"><em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structiotsec__msg__t.html">iotsec_msg_t</a> *&#160;</td>
          <td class="paramname"><em>resp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send a request to the server and receive the response. </p>
<p>This function sets the message ID and token fields of the request message overriding any values set by the calling function.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">client</td><td>Pointer to a client structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">req</td><td>Pointer to the request message </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">resp</td><td>Pointer to the response message</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Operation status </dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>Success </td></tr>
    <tr><td class="paramname">&lt;0</td><td>Error </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="abf1cda72f615128e0ab705562e809bc7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abf1cda72f615128e0ab705562e809bc7">&#9670;&nbsp;</a></span>iotsec_client_exchange_blockwise()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ssize_t iotsec_client_exchange_blockwise </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structiotsec__client__t.html">iotsec_client_t</a> *&#160;</td>
          <td class="paramname"><em>client</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structiotsec__msg__t.html">iotsec_msg_t</a> *&#160;</td>
          <td class="paramname"><em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structiotsec__msg__t.html">iotsec_msg_t</a> *&#160;</td>
          <td class="paramname"><em>resp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>block1_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>block2_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>body</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>body_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>have_resp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Exchange with the server using blockwise transfers. </p>
<p>The calling application should not pass in a request message that contains a block1 or block2 option. This function will add block1 and block2 options internally. This function sets the message ID and token fields of the request message overriding any values set by the calling function.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">client</td><td>Pointer to a client structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">req</td><td>Pointer to the request message </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">resp</td><td>Pointer to the response message </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">block1_size</td><td>Block1 size </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">block2_size</td><td>Block2 size </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">body</td><td>Pointer to a buffer to hold the body </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">body_len</td><td>Length of the buffer to hold the body </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">have_resp</td><td>Flag to indicate that the first response has already been received</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Operation status </dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">&gt;=0</td><td>Length of the data received </td></tr>
    <tr><td class="paramname">&lt;0</td><td>Error </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
